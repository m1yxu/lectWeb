(function(){function e(e){function n(){this.$constructor.apply(this,arguments)}var t=e.$static;if(t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);delete e.$static}return n.prototype=e,n.prototype.constructor=n,n}function t(e,t){return function(){return e.apply(t,arguments)}}function n(){return window.pageYOffset||(document.documentElement||document.body).scrollTop||0}function r(e){var t=e.getBoundingClientRect().top;return t+n()}function i(e){return Object.prototype.toString.call(e)==="[object Array]"}function s(e){return Object.prototype.toString.call(e)==="[object Object]"}function o(e,t){function a(e,t){for(var n in t){if(t.hasOwnProperty(n)===!1)continue;f(t[n])?e[n]=o(e[n],[t[n]]):e[n]=t[n]}}function f(e){return s(e)||i(e)}var n=t.length,r;for(var u=0;u<n;u++)r=t[u],e===undefined&&i(r)?e=[]:e===undefined&&(e={}),a(e,r);return e}function u(e,t){if(e.indexOf)return e.indexOf(t);var n=e.length;for(var r=0;r<n;r++)if(e[r]===t)return r;return-1}function a(e,t){var n=e.split("?"),r=n[0],i=n[1]||"",s=i.split("&"),o="",a="",f=[];for(var l=0,c=s.length;l<c;l++){o=s[l],a=o.split("=")[0];if(o===""||a==="")continue;if(u(t,a)>-1)continue;f.push(o)}return f.length>0?r+"?"+f.join("&"):r}function f(e,t){return e===t||e.contains(t)}function l(){var e=window.performance&&window.performance.navigation;return Boolean(e)===!1?!1:e.type===(e.TYPE_NAVIGATE||0)}function c(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}function h(e){return e.offsetHeight}function p(e){return e.href&&e.href.substr(0,4)==="http"}function d(e,t){return e.ctrlKey||e.shiftKey||e.metaKey||e.button===1||t.getAttribute("target")==="_blank"}function v(){return{title:function(){var e=m("og:title");return Boolean(e)?e:null}(),thumbnail:function(){var e=m("og:image");return Boolean(e)?e.split("?")[0]:null}()}}function m(e){var t=null;try{t=document.querySelector('meta[property="'+e+'"]').getAttribute("content")}catch(n){}return t}function g(e,t){return(new RegExp("[&?]"+e+"=")).test(t||location.href)}function y(e,t){return(new RegExp("[&?]"+e+"=([^&]+)")).test(t||location.href)?RegExp.$1:null}function b(e){return e.replace(/^\s+|\s+$/g,"")}function w(e,t){var n=a(E(),[e]),r=n.indexOf("?")===-1?"?":"&",i=e+"="+t;return n+r+i}function E(){var e=location.href,t=location.host;if(e.indexOf("entertain.naver.com/")>-1)return e;if(/n\.news\.naver\.com\/entertain\/(?:.+\/)?([0-9]+)\/([0-9]+)/g.test(e))return"https://entertain.naver.com/read?oid="+RegExp.$1+"&aid="+RegExp.$2;if(t.indexOf("sports")>-1&&y("oid",e))return"https://sports.news.naver.com/news?oid="+y("oid",e)+"&aid="+y("aid",e);if(/n\.news\.naver\.com\/sports\/(?:.+\/)?([0-9]+)\/([0-9]+)/g.test(e))return"https://sports.news.naver.com/news?oid="+RegExp.$1+"&aid="+RegExp.$2;if(t.indexOf("sports")>-1)return"https://sports.naver.com/video?id="+(y("id",e)||y("id",m("og:url")));if(t.indexOf("tv.")>-1)return e.replace(/\/\/(?:.+)?m\./g,"//");if(/n\.news\.naver\.com\/(?:.+\/)?([0-9]+)\/([0-9]+)/g.test(e))return"https://news.naver.com/main/read.nhn?oid="+RegExp.$1+"&aid="+RegExp.$2;if(t.indexOf("news.naver.com")>-1)return"https://news.naver.com/main/read.nhn?oid="+y("oid",e)+"&aid="+y("aid",e)}function T(){var e="NID_SES";return document.cookie.indexOf(e+"=")>-1}function N(){if(Boolean(document.referrer)===!1)return!1;var e=document.createElement("a");return e.href=document.referrer,e.hostname.indexOf("m.naver.com")>-1||e.hostname.indexOf("www.naver.com")>-1}function C(){return navigator.userAgent&&navigator.userAgent.indexOf("Whale")>=0}var S={};(function(){S.on=function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent("on"+t,n)},S.off=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent("on"+t,n)}})(),function(){var e=[];S.delegateClick=function(t,n){var r=function(e){var r=e.target||e.srcElement,i=document.querySelectorAll(t),s=null;for(var o=0,u=i.length;o<u;o++)s=i[o],f(s,r)&&n(e,{delegatedEl:s})};e.push({selector:t,originHandler:n,attachedHandler:r}),S.on(window.document,"click",r)},S.undelegateClick=function(t,n){var r,i=[];for(var s=0,o=e.length;s<o;s++){r=e[s];if(r.selector===t&&r.originHandler===n){S.off(window.document,"click",r.attachedHandler);continue}i.push(r)}e=i}}(),function(){var e,t,n=[];document.hidden!==undefined?(e="hidden",t="visibilitychange"):document.msHidden!==undefined?(e="msHidden",t="msvisibilitychange"):document.webkitHidden!==undefined&&(e="webkitHidden",t="webkitvisibilitychange"),S.onVisibilityChange=function(r){function i(t){r(t,{isHidden:window.document[e]})}if(e===undefined)return;n.push({originHandler:r,attachedHandler:i}),S.on(window.document,t,i)},S.offVisibilityChange=function(e){var r,i=[];for(var s=0,o=n.length;s<o;s++){r=n[s];if(r.originHandler===e){S.off(window.document,t,r.attachedHandler);continue}i.push(r)}n=i}}();var x=e({$static:{_API_PATH_TEMPLATE:{put:"/nudge/v2/messages/{{messageId}}/create",remove:"/nudge/v2/messages/{{messageId}}/delete"}},$constructor:function(e){this._apiPut=e.apiDomain+this.constructor._API_PATH_TEMPLATE.put.replace("{{messageId}}",e.contentId),this._apiRemove=e.apiDomain+this.constructor._API_PATH_TEMPLATE.remove.replace("{{messageId}}",e.contentId),this._isAlreadyPut=!1},put:function(e){if(this._isAlreadyPut)return!1;var t=this._apiPut,n=this._getQueryAsMap(e);return this._sendByBeacon(t,n)===!1&&this._sendByImg(t,n),this.changeToUnputtable(),!0},remove:function(e){var t=this._apiRemove,n={categories:e};this._sendByBeacon(t,n)===!1&&this._sendByImg(t,n),this.changeToPuttable()},removeIfPut:function(e){this._isAlreadyPut&&this.remove(e)},changeToUnputtable:function(){this._isAlreadyPut=!0},changeToPuttable:function(){this._isAlreadyPut=!1},_getQueryAsMap:function(e){return{categories:e.category,url:encodeURIComponent(w(e.restore.key,e.restore.value)),agentDeviceType:this._getPlatform(),data:function(){var t={},n;for(var r in e.meta)n=e.meta[r],t[r]=n?encodeURIComponent(n):null;return encodeURIComponent(JSON.stringify(t))}()}},_sendByImg:function(e,t){var n=new Image,r=[];for(var i in t)r.push(i+"="+t[i]);n.src=e+"?"+r.join("&")},_sendByBeacon:function(e,t){var n=Boolean(navigator.sendBeacon)&&Boolean(window.FormData);if(n===!1)return!1;var r=new FormData;for(var i in t)r.append(i,t[i]);return navigator.sendBeacon(e,r)},_getPlatform:function(){var e=location.href;return/m\.(?:.+)\.naver\.com/g.test(e)||/n\.(?:.+)\.naver\.com/g.test(e)||location.host.indexOf("mobile")>-1?"mobile":"pc"}}),k=new(e({$static:{_CONFIG:{PUT_TRY_CONDITION:{SCROLL_IDLE_TIME_MAX_MS:12e4},PUT_CONDITION:{MIN_STAY_TIME:1e4,MIN_READING_PROGRESS_RATE:.2,MIN_STAY_TIME_IN_LAST_PARAGRAPH_FOR_READ_COMPLETE:2e4},LAST_PARAGRAPH_POSITION_MIN_RATE_IN_VIEWPORT:.7,VIEWPORT_RATE_TO_SCROLL_UP_FOR_RESTORE_READABILITY:.25,PARAM_FOR_RESTORE:"hstate"},_SCROLL_EVENT_DELAY_TIME:100},$constructor:function(){},init:function(e,t){try{return this._init(e,t)}catch(n){}},_init:function(e,n){this.deactivate();if(T()===!1)return;return this._config=this.constructor._CONFIG,this._category=n.category,this._articleEl=e,this._pageEntryTime=(new Date).getTime(),this._isReadComplete=!1,this._timerIdForDelayScrollEvent=null,this._timerIdForOverScrollIdleTime=null,this._timerIdForReadLastParagraph=null,this._sender=new x({apiDomain:n.apiDomain,contentId:n.contentId}),this._onUnloadPage=t(this._onUnloadPage,this),this._onScroll=t(this._onScroll,this),this._onClickLink=t(this._onClickLink,this),this._onTabVisibilityChange=t(this._onTabVisibilityChange,this),this._isAccessingByRestoreUrl()&&setTimeout(t(function(){if(l()===!1)return;this._restoreReadingProgressRate()},this),500),this.activate(),this},activate:function(){S.on(window,"beforeunload",this._onUnloadPage),S.on(window,"pagehide",this._onUnloadPage),S.on(window,"unload",this._onUnloadPage),S.on(window,"scroll",this._onScroll),S.delegateClick("a",this._onClickLink),S.onVisibilityChange(this._onTabVisibilityChange)},deactivate:function(){S.off(window,"beforeunload",this._onUnloadPage),S.off(window,"pagehide",this._onUnloadPage),S.off(window,"unload",this._onUnloadPage),S.off(window,"scroll",this._onScroll),S.undelegateClick("a",this._onClickLink),S.offVisibilityChange(this._onTabVisibilityChange),this._clearTimeoutForDelayScrollEvent(),this._clearTimeoutForOverScrollIdleTime(),this._clearTimeoutForReadLastParagraph()},_onUnloadPage:function(){this._put()},_onScroll:function(){this._clearTimeoutForDelayScrollEvent(),this._timerIdForDelayScrollEvent=setTimeout(t(function(){this._checkReadLastParagraph(),this._putAfterOverScrollIdleTime(),this._remove("scroll"),this._sender.changeToPuttable()},this),this.constructor._SCROLL_EVENT_DELAY_TIME)},_onClickLink:function(e,t){p(t.delegatedEl)&&d(e,t.delegatedEl)===!1&&(this.deactivate(),this._remove("click"))},_onTabVisibilityChange:function(e,t){t.isHidden&&this._put()},_put:function(){if(this._isLessThanMinStayTime())return;if(this._isLessThanMinReadingProgressRate())return;if(this._isScrollPositionInArticleBody()===!1)return;if(this._isReadComplete)return;this._sender.put({category:this._category,meta:this._getPageMetaData(),restore:{key:this._config.PARAM_FOR_RESTORE,value:this._getReadingProgressRateForRestore()}})},getRestoringUrl:function(){return w(this._config.PARAM_FOR_RESTORE,this._getReadingProgressRateForRestore())},_remove:function(e){switch(e){case"scroll":this._sender.removeIfPut(this._category);break;case"readComplete":case"click":this._isAccessingByRestoreUrl()?this._sender.remove(this._category):this._sender.removeIfPut(this._category)}},_putAfterOverScrollIdleTime:function(){this._clearTimeoutForOverScrollIdleTime(),this._timerIdForOverScrollIdleTime=setTimeout(t(this._put,this),this._config.PUT_TRY_CONDITION.SCROLL_IDLE_TIME_MAX_MS)},_restoreReadingProgressRate:function(){var e=Number(y(this._config.PARAM_FOR_RESTORE)||0),t=c().height*this._config.VIEWPORT_RATE_TO_SCROLL_UP_FOR_RESTORE_READABILITY;if(e===0||isNaN(e))return;window.scrollTo(0,h(this._articleEl)*e+r(this._articleEl)-t)},_checkReadLastParagraph:function(){this._clearTimeoutForReadLastParagraph();if(this._isLastProgressRate()===!1)return;this._timerIdForReadLastParagraph=setTimeout(t(function(){this._isReadComplete=!0,this._remove("readComplete")},this),this._config.PUT_CONDITION.MIN_STAY_TIME_IN_LAST_PARAGRAPH_FOR_READ_COMPLETE)},_isLastProgressRate:function(){var e=this._getReadingProgressRate(),t=this._getLastProgressRateRange();return e>=t.min&&e<=t.max},_isScrollPositionInArticleBody:function(){return this._getReadingProgressRate()<1},_isLessThanMinStayTime:function(){var e=(new Date).getTime()-this._pageEntryTime;return e<this._config.PUT_CONDITION.MIN_STAY_TIME},_isLessThanMinReadingProgressRate:function(){return this._getReadingProgressRate()<this._config.PUT_CONDITION.MIN_READING_PROGRESS_RATE},_getReadingProgressRate:function(){return n()/h(this._articleEl)},_getReadingProgressRateForRestore:function(){var e=(n()-r(this._articleEl))/h(this._articleEl);return e.toFixed(5)},_getLastProgressRateRange:function(){var e=h(this._articleEl),t=c().height,n=this._config.LAST_PARAGRAPH_POSITION_MIN_RATE_IN_VIEWPORT;return{min:Math.max(1-t*n/e,0),max:1}},_getPageMetaData:function(){var e=v();return e.pressName=function(){var e="";try{var t=document.querySelector('meta[property="og:article:author"]').getAttribute("content").split("|");for(var n=0;n<t.length;n++)if(t[n].indexOf("네이버")===-1){e=t[n];break}}catch(r){}return b(e)}(),e.contentCreateTime=function(){var e=document.querySelector(".article_info .t11")||document.querySelector(".news_headline .info span")||document.querySelector(".media_end_head_info .media_end_head_info_datestamp_time")||document.querySelector(".article_info .author em");return e?b(e.innerText.replace("기사입력","")):null}(),e},_clearTimeoutForReadLastParagraph:function(){clearTimeout(this._timerIdForReadLastParagraph)},_clearTimeoutForDelayScrollEvent:function(){clearTimeout(this._timerIdForDelayScrollEvent)},_clearTimeoutForOverScrollIdleTime:function(){clearTimeout(this._timerIdForOverScrollIdleTime)},_isAccessingByRestoreUrl:function(){return g(this._config.PARAM_FOR_RESTORE)}})),L=e({$static:{},$constructor:function(e){this.deactivate(),this._player=e,this._isFirstPlay=!0,this.properties={},this.properties.callbackFunction=function(e){},this.properties.callbackHandler=null,this._onLoadStart=t(this._onLoadStart,this),this._onPause=t(this._onPause,this),this._onPlay=t(this._onPlay,this),this._onEnded=t(this._onEnded,this),this._activate()},_activate:function(){this._player.addEventListener("loadstart",this._onLoadStart),this._player.addEventListener("pause",this._onPause),this._player.addEventListener("play",this._onPlay),this._player.addEventListener("ended",this._onEnded)},deactivate:function(){try{this._player.removeEventListener("loadstart",this._onLoadStart),this._player.removeEventListener("pause",this._onPause),this._player.removeEventListener("play",this._onPlay),this._player.removeEventListener("ended",this._onEnded)}catch(e){}},_onLoadStart:function(){this._isFirstPlay=!0,this.properties.callbackFunction("ready")},_onPause:function(){this.properties.callbackFunction("pause")},_onPlay:function(){this._isFirstPlay&&(this.properties.callbackFunction("onContentFirstPlay"),this._isFirstPlay=!1),this.properties.callbackFunction("play")},_onEnded:function(){this.properties.callbackFunction("complete")},getCurrentTime:function(){return this._player.currentTime},currentTime:function(e){this._player.currentTime=e},getDuration:function(){return this._player.duration},getVideoInfo:function(){return{subject:this._player.srcObject.data.meta.subject,coverImage:this._player.poster}}}),A=new(e({$static:{_CONFIG:{DEFAULT:{MIN_DURATION_TIME_SEC:30,PUT_TRY_CONDITION:{PAUSE_IDLE_TIME_MAX_MS:3e3},PUT_CONDITION:{MIN_PLAY_TIME_SEC:20},PARAM_FOR_RESTORE:"hstate"},tv_video:{MIN_DURATION_TIME_SEC:30,PUT_CONDITION:{MIN_PLAY_TIME_SEC:20}}}},$constructor:function(){},init:function(e,t){try{return this._init(e,t)}catch(n){}},_init:function(e,n){this.deactivate();if(T()===!1)return;this._config=this.constructor._CONFIG.DEFAULT,this.constructor._CONFIG[n.category]&&(this._config=o({},[this._config,this.constructor._CONFIG[n.category]])),this._category=n.category,this._player=e,this._player.properties===undefined&&(this._player=new L(e));if(Boolean(this._player)===!1||this._player.getCurrentTime===undefined||this._player.currentTime===undefined)return;return this._isActivating=!1,this._isMainVideo=!1,this._isPlayEnded=!1,this._isRestored=!1,this._isPlaying=!1,this._timerIdForOverPauseIdleTime=null,this._sender=new x({apiDomain:n.apiDomain,contentId:n.contentId}),this._onUnloadPage=t(this._onUnloadPage,this),this._onClickLink=t(this._onClickLink,this),this._onTabVisibilityChange=t(this._onTabVisibilityChange,this),t(function(){var e=this._player.properties.callbackHandler,n=window[e]||this._player.properties.callbackFunction||function(){},r=t(function(e){n.apply(null,arguments);switch(e){case"ready":this._isMainVideo=!1,this._isPlayEnded=!1,this._isPlaying=!1,this._clearTimeoutForOverPauseIdleTime(),this.deactivate();break;case"pause":this._isPlaying=!1,this._putAfterOverPauseIdleTime();break;case"play":this._clearTimeoutForOverPauseIdleTime(),this._remove("play"),this._sender.changeToPuttable(),this._isPlaying=!0,(N()||C())&&l()&&this._restoreOnce();break;case"onContentFirstPlay":case"content_loadstart":this._isMainVideo=!0;if(this._isLessThanMinDuration()){this.deactivate();return}this.activate();break;case"complete":case"contentended":if(this._isPlayEnded)return;this._isPlayEnded=!0,this._remove("complete")}},this);if(window[e])window[e]=r;else if(this._player.properties.callbackFunction||this._player.properties.callbackFunction!==undefined)this._player.properties.callbackFunction=r},this)(),this},activate:function(){if(this._isActivating)return;S.on(window,"beforeunload",this._onUnloadPage),S.on(window,"pagehide",this._onUnloadPage),S.on(window,"unload",this._onUnloadPage),S.delegateClick("a",this._onClickLink),S.onVisibilityChange(this._onTabVisibilityChange),this._isActivating=!0},deactivate:function(){if(this._isActivating!==!0)return;S.off(window,"beforeunload",this._onUnloadPage),S.off(window,"pagehide",this._onUnloadPage),S.off(window,"unload",this._onUnloadPage),S.undelegateClick("a",this._onClickLink),S.offVisibilityChange(this._onTabVisibilityChange),this._clearTimeoutForOverPauseIdleTime(),this._isActivating=!1},_onUnloadPage:function(){this._put()},_onClickLink:function(e,t){p(t.delegatedEl)&&d(e,t.delegatedEl)===!1&&(this.deactivate(),this._remove("click"))},_onTabVisibilityChange:function(e,t){if(t.isHidden){this._put();return}this._isPlaying&&this._remove("visible")},_put:function(){if(this._isActivating!==!0)return;if(this._isMainVideo===!1)return;if(this._isPlayEnded)return;if(this._isLessThanMinPlayTime())return;this._sender.put({category:this._category,meta:this._getPageMetaData(),restore:{key:this._config.PARAM_FOR_RESTORE,value:this._player.getCurrentTime()}})},getRestoringUrl:function(){return w(this._config.PARAM_FOR_RESTORE,this._player.getCurrentTime())},_remove:function(e){switch(e){case"play":case"visible":this._sender.removeIfPut(this._category);break;case"complete":case"click":this._isAccessingByRestoreUrl()?this._sender.remove(this._category):this._sender.removeIfPut(this._category)}},_putAfterOverPauseIdleTime:function(){this._clearTimeoutForOverPauseIdleTime(),this._timerIdForOverPauseIdleTime=setTimeout(t(this._put,this),this._config.PUT_TRY_CONDITION.PAUSE_IDLE_TIME_MAX_MS)},_restoreOnce:function(){if(this._isRestored)return;var e=this._getRestoreValue(),n=null,r=t(function(){this._player.currentTime(e),clearTimeout(n),parseInt(this._player.getCurrentTime(),10)!==parseInt(e,10)&&(n=setTimeout(r,10))},this);e&&r(),this._isRestored=!0},_getPageMetaData:function(){var e=v(),t=null;try{t=this._player.getVideoInfo(),e.title=t.subject,e.thumbnail=t.coverImage.split("?")[0]}catch(n){}return e.contentCreateTime=function(){var e=document.querySelector(".video_summary .date")||document.querySelector(".playlist_info .time")||document.querySelector(".title_info .date")||document.querySelector(".rating_list dd");return e?b(e.innerText.replace("등록","")):null}(),e},_getRestoreValue:function(){var e=Number(y(this._config.PARAM_FOR_RESTORE)||0);if(e===0||isNaN(e))return;return e},_isAccessingByRestoreUrl:function(){return g(this._config.PARAM_FOR_RESTORE)},_isLessThanMinDuration:function(){var e=this._getDuration();return Boolean(e)===!1?!1:e<this._config.MIN_DURATION_TIME_SEC},_isLessThanMinPlayTime:function(){return this._player.getCurrentTime()<this._config.PUT_CONDITION.MIN_PLAY_TIME_SEC},_getDuration:function(){var e=0;try{e=this._player.getDuration()}catch(t){}return e||0},_clearTimeoutForOverPauseIdleTime:function(){clearTimeout(this._timerIdForOverPauseIdleTime)}}));window.handOff={version:"1.4.1 (03/11 2021 11:48:14)",Article:k,Video:A}})();
(function(){function e(e){function n(){this.$constructor.apply(this,arguments)}var t=e.$static;if(t){for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]);delete e.$static}return n.prototype=e,n.prototype.constructor=n,n}function r(e,t){return function(){return e.apply(t,arguments)}}function i(){return window.pageYOffset||(document.documentElement||document.body).scrollTop||0}function s(e){return e.offsetHeight}function o(e){var t=e.getBoundingClientRect().top;return t+i()}function u(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}function a(){var e=window.performance&&window.performance.navigation;return Boolean(e)===!1?!1:e.type===e.TYPE_BACK_FORWARD}function f(e){return JSON.parse(JSON.stringify(e))}function l(){return(new Date).getTime()}var t={};(function(){t.on=function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent("on"+t,n)},t.off=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent("on"+t,n)}})(),function(){var e,n,r=[];document.hidden!==undefined?(e="hidden",n="visibilitychange"):document.msHidden!==undefined?(e="msHidden",n="msvisibilitychange"):document.webkitHidden!==undefined&&(e="webkitHidden",n="webkitvisibilitychange"),t.onVisibilityChange=function(i){function s(t){i(t,{isHidden:window.document[e]})}if(e===undefined)return;r.push({originHandler:i,attachedHandler:s}),t.on(window.document,n,s)},t.offVisibilityChange=function(e){var i,s=[];for(var o=0,u=r.length;o<u;o++){i=r[o];if(i.originHandler===e){t.off(window.document,n,i.attachedHandler);continue}s.push(i)}r=s}}();var n=e({$static:{},$constructor:function(){},send:function(e,t){var n=JSON.stringify(t);this._sendByBeacon(e,n)===!1&&this._sendByImg(e,n)},_sendByImg:function(e,t){var n=new Image;n.onload=n.onerror=function(){n.onload=null,n.onerror=null},n.src=e+"?d="+encodeURIComponent(t)},_sendByBeacon:function(e,t){return Boolean(navigator.sendBeacon)===!1?!1:navigator.sendBeacon(e,t)}}),c=e({$constructor:function(){this._isActivating=!1},init:function(){return this.deactivate(),this._watchedRanges=[],this.activate(),this},activate:function(){return this._isActivating=!0,this},deactivate:function(){return this._isActivating=!1,this},update:function(e,t){if(this._isActivating===!1)return;var n=[e,e+t];this._updateRanges(n)},get:function(e){if(this._isActivating===!1)return 0;var t=0,n=this._watchedRanges.length,r=[];for(var i=0;i<n;i++)r=this._watchedRanges[i],t+=r[1]-r[0];return t/e},_updateRanges:function(e){var t=this._watchedRanges.length,n=[],r=e,i=[],s=null;for(var o=0;o<t;o++)i=this._watchedRanges[o],s=this._mergeIfIsIntersection(i,r),s?r=s:n.push(i);n.push(r),this._watchedRanges=n},_mergeIfIsIntersection:function(e,t){var n={start:e[0],end:e[1]},r={start:t[0],end:t[1]},i=n.start<r.start?n:r,s=i===n?r:n;return i.end<s.start?null:[i.start,i.end>s.end?i.end:s.end]}}),h=e({$constructor:function(){this._isActivating=!1},init:function(){return this.deactivate(),this._totalWatchSecond=0,this.activate(),this},activate:function(){return this._isActivating=!0,this},deactivate:function(){return this._isActivating=!1,this},update:function(e){if(this._isActivating===!1)return;this._totalWatchSecond=this._totalWatchSecond+e},get:function(){return this._isActivating===!1?0:this._totalWatchSecond}}),p=e({$static:{_READ_TIME_PER_CHARACTER:113,_MAIN_VIDEO_PERCENT_COMPARE_TO_TEXT:50,_TEXT_PERCENT_COMPARE_TO_MAIN_VIDEO:50},$constructor:function(){this._videoAppendObserver=new d,this._watchTime=new h,this._watchRate=new c,this._onPlay=r(this._onPlay,this),this._onPause=r(this._onPause,this),this._onSeeked=r(this._onSeeked,this)},init:function(e,n){return this._deactivate(),document.querySelectorAll(e).length===0?!1:document.querySelectorAll(e).length>=2?!1:n?(this._textTotalReadSecond=n*this.constructor._READ_TIME_PER_CHARACTER/1e3,this._videoEl=null,this._videoDurationSecond=0,this._dateTimestampOnPlay=null,this._videoSecondOnPlay=null,this._videoAppendObserver.init({observerTarget:document.querySelector(e),onAppendVideo:r(function(e){this._videoEl=e,this._activate(),this._watchTime.init(),this._watchRate.init(),t.on(e,"loadedmetadata",r(function(){this._videoDurationSecond=this._videoEl.duration},this))},this)}),this):!1},_activate:function(){try{t.on(this._videoEl,"play",this._onPlay),t.on(this._videoEl,"pause",this._onPause),t.on(this._videoEl,"seeked",this._onSeeked)}catch(e){}},_deactivate:function(){try{t.off(this._videoEl,"play",this._onPlay),t.off(this._videoEl,"pause",this._onPause),t.off(this._videoEl,"seeked",this._onSeeked),this._watchTime.deactivate(),this._watchRate.deactivate()}catch(e){}},isMainVideo:function(){return this._videoDurationSecond?this._videoDurationSecond/this._textTotalReadSecond*100>=this.constructor._MAIN_VIDEO_PERCENT_COMPARE_TO_TEXT:!1},isTextContainVideoContent:function(){return this.isMainVideo()?this._textTotalReadSecond/this._videoDurationSecond*100>=this.constructor._TEXT_PERCENT_COMPARE_TO_MAIN_VIDEO:!0},getWatchTimeMs:function(){return this._updateLog(),this._watchTime.get()*1e3},getWatchRate:function(){return this._videoDurationSecond?(this._updateLog(),this._watchRate.get(this._videoDurationSecond)):0},getVideoDurationSecond:function(){return this._videoDurationSecond},_onPlay:function(){var e=this._videoEl.currentTime;this._dateTimestampOnPlay=l(),this._videoSecondOnPlay=e},_onPause:function(){this._updateLog()},_onSeeked:function(){if(this._videoEl.paused)return;this._onPause(),this._onPlay()},_updateLog:function(){if(this._dateTimestampOnPlay===null||this._videoSecondOnPlay===null)return;var e=this._getCurrentWatchedSecond();this._watchTime.update(e),this._watchRate.update(this._videoSecondOnPlay,e),this._dateTimestampOnPlay=null,this._videoSecondOnPlay=null},_getCurrentWatchedSecond:function(){if(!this._dateTimestampOnPlay)return 0;var e=l()-this._dateTimestampOnPlay;return e/1e3}}),d=e({$static:{},$constructor:function(){},init:function(e){var t=e.observerTarget,n=e.onAppendVideo;this._disconnect(),this._observer=null,this._timeoutIdForSetTimeoutObserver=null;if(t.querySelector("video")){n(t.querySelector("video"));return}try{this._observe(t,n)}catch(r){this._observeBySetTimeout(t,n)}},_disconnect:function(){try{clearTimeout(this._timeoutIdForSetTimeoutObserver),this._observer.disconnect()}catch(e){}},_observe:function(e,t){this._observer=new MutationObserver(r(function(){var n=e.querySelector("video");if(!n)return;t(n),this._disconnect()},this)),this._observer.observe(e,{childList:!0})},_observeBySetTimeout:function(e,t){var n=l(),i=1e4,s=r(function(){this._timeoutIdForSetTimeoutObserver=setTimeout(function(){if(l()-n>=i)return;var r=e.querySelector("video");if(!r){s();return}t(r)},200)},this);s()}}),v=e({$static:{_LIMIT_IDLE_TIME_FOR_ACTIVE_EXPIRE:6e4},$constructor:function(){this._onScroll=r(this._onScroll,this),this._onClick=r(this._onClick,this)},init:function(){return this._dt=0,this._isActivating=!0,this._lastActivityStartTimestamp=l(),this._timerIdForActiveExpire=null,t.on(window,"scroll",this._onScroll),t.on(document,"click",this._onClick),this._onActivate(),this},getDt:function(){return this._updateDt(),this._dt},_onScroll:function(){this._onActivate()},_onClick:function(){this._onActivate()},_onActivate:function(){this._isActivating===!1&&(this._isActivating=!0,this._lastActivityStartTimestamp=l()),clearTimeout(this._timerIdForActiveExpire),this._timerIdForActiveExpire=setTimeout(r(function(){this._updateDt()},this),this.constructor._LIMIT_IDLE_TIME_FOR_ACTIVE_EXPIRE)},_updateDt:function(){if(this._isActivating===!1)return;var e=0;this._lastActivityStartTimestamp&&(e=l()-this._lastActivityStartTimestamp),this._dt=this._dt+e,this._isActivating=!1,this._lastActivityStartTimestamp=null}}),m=e({$static:{_LIMIT_IDLE_TIME_FOR_ACTIVE_EXPIRE:6e4},$constructor:function(){},init:function(e){return this._dt=0,this._isCurrentScrollInContentBody=!1,this._bodyEntryStartTimestamp=null,this._timerIdForActiveExpire=null,this.update(e),this},getDt:function(){return this._calculateDt(),this._dt},update:function(e){var t=this._isCurrentScrollInContentBody,n=e;n&&this._resetActiveExpireTimer();if(n&&t===!1){this._isCurrentScrollInContentBody=!0,this._bodyEntryStartTimestamp=l();return}t&&n===!1&&this._calculateDt()},_resetActiveExpireTimer:function(){clearTimeout(this._timerIdForActiveExpire),this._timerIdForActiveExpire=setTimeout(r(function(){this._isCurrentScrollInContentBody&&this._calculateDt()},this),this.constructor._LIMIT_IDLE_TIME_FOR_ACTIVE_EXPIRE)},_calculateDt:function(){if(this._bodyEntryStartTimestamp===null)return;var e=l()-this._bodyEntryStartTimestamp;this._dt=this._dt+e,this._isCurrentScrollInContentBody=!1,this._bodyEntryStartTimestamp=null}}),g=e({$static:{_READ_TIME_PER_CHARACTER:100},$constructor:function(){},init:function(e){return this._contentBodyLength=e.contentBodyLength,this._totalReadTime=this._contentBodyLength*this.constructor._READ_TIME_PER_CHARACTER,this._contentBodyHeight=0,this._maxReadTimeWithoutScroll=0,this.setContentBodyHeight(e.contentBodyHeight),this._readStartTimestamp=null,this._readStartScrollTop=null,this._isCurrentScrollInArticleBody=!1,this._readRanges=[],this.update(e.isScrollPositionInArticleBody),this},update:function(e){var t=this._isCurrentScrollInArticleBody;t&&this._updateReadRanges(this._getPrevReadRange()),this._updateReadProperties(e)},setContentBodyHeight:function(e){this._contentBodyHeight=e,this._maxReadTimeWithoutScroll=this._getMaxReadTimeWithoutScroll()},getReadRatio:function(e){this.update(e);var t=0,n=this._readRanges.length,r=[];for(var i=0;i<n;i++)r=this._readRanges[i],t+=r[1]-r[0];return t/this._contentBodyHeight},_getPrevReadRange:function(){if(this._readStartScrollTop===null||this._readStartTimestamp===null)return null;var e=l(),t=e-this._readStartTimestamp;t>this._maxReadTimeWithoutScroll&&(t=this._maxReadTimeWithoutScroll);var n=t/this._totalReadTime,r=this._contentBodyHeight*n;return[this._readStartScrollTop,this._readStartScrollTop+r]},_updateReadProperties:function(e){e?(this._readStartTimestamp=l(),this._readStartScrollTop=i(),this._isCurrentScrollInArticleBody=!0):(this._readStartTimestamp=null,this._readStartScrollTop=null,this._isCurrentScrollInArticleBody=!1)},_getMaxReadTimeWithoutScroll:function(){var e=u().height/this._contentBodyHeight;return this._totalReadTime*e},_updateReadRanges:function(e){var t=this._readRanges.length,n=[],r=e,i=[],s=null;for(var o=0;o<t;o++)i=this._readRanges[o],s=this._mergeIfIsIntersection(i,r),s?r=s:n.push(i);n.push(r),this._readRanges=n},_mergeIfIsIntersection:function(e,t){var n={start:e[0],end:e[1]},r={start:t[0],end:t[1]},i=n.start<r.start?n:r,s=i===n?r:n;return i.end<s.start?null:[i.start,i.end>s.end?i.end:s.end]}}),y=e({$static:{_ARTICLE_DISTANCE_RATE_IN_VIEWPORT:{START:.5,END:.4},_BYLINE_HEIGHT:250,_SCROLL_END_TIMEOUT:300},$constructor:function(){this._isActivating=!1,this._contentBodyDurationTime=new m,this._contentBodyReadRatio=new g,this._contentBodyHeightObserver=new b,this._onScroll=r(this._onScroll,this),this._onClick=r(this._onClick,this)},init:function(e){this._deactivate();if(Boolean(e)===!1)return;return this._contentBodyEl=e,this._timerIdForScrollEnd=null,this._contentBodyScrollRange={start:null,end:null},this._updateContentBodyScrollRange(),this._contentBodyDurationTime.init(this._isScrollInContentBody()),this._contentBodyReadRatio.init({contentBodyLength:this._contentBodyEl.innerText.length,contentBodyHeight:s(this._contentBodyEl),isScrollPositionInArticleBody:this._isScrollInContentBody()}),this._activate(),this._contentBodyHeightObserver.init({contentBodyEl:this._contentBodyEl,onChangeHeight:r(function(){try{this._updateContentBodyScrollRange(),this._contentBodyReadRatio.setContentBodyHeight(s(this._contentBodyEl))}catch(e){}},this)}),this},_activate:function(){try{t.on(window,"scroll",this._onScroll),t.on(document,"click",this._onClick),this._isActivating=!0}catch(e){}},_deactivate:function(){try{t.off(window,"scroll",this._onScroll),t.off(document,"click",this._onClick),this._isActivating=!1}catch(e){}},isActivating:function(){return this._isActivating},getDurationTime:function(){return this._isActivating===!1?0:this._contentBodyDurationTime.getDt()},getReadRate:function(){return this._isActivating===!1?0:this._contentBodyReadRatio.getReadRatio(this._isScrollInContentBody())},getLength:function(){return this._isActivating===!1?0:this._contentBodyEl.innerText.length},_onScroll:function(){clearTimeout(this._timerIdForScrollEnd),this._timerIdForScrollEnd=setTimeout(r(function(){this._updateDtInContentBody(),this._contentBodyReadRatio.update(this._isScrollInContentBody())},this),this.constructor._SCROLL_END_TIMEOUT)},_onClick:function(){this._updateDtInContentBody()},_updateDtInContentBody:function(){this._contentBodyDurationTime.update(this._isScrollInContentBody())},_updateContentBodyScrollRange:function(){var e=o(this._contentBodyEl);this._contentBodyScrollRange={start:r(function(){var t=this.constructor._ARTICLE_DISTANCE_RATE_IN_VIEWPORT.START,n=u().height*t;return Math.max(e-n,0)},this)(),end:r(function(){var t=e+s(this._contentBodyEl),n=this.constructor._ARTICLE_DISTANCE_RATE_IN_VIEWPORT.END,r=this.constructor._BYLINE_HEIGHT,i=u().height*n+r;return t-i},this)()}},_isScrollInContentBody:function(){var e=this._contentBodyScrollRange,t=i();return t>=e.start&&t<=e.end}}),b=e({$static:{},$constructor:function(e){},init:function(e){var t=e.contentBodyEl,n=e.onChangeHeight;this._clearTimeout(),this._timerIdForResizeObserverEventDelay=null;try{this._observeResize(t,n)}catch(r){setTimeout(function(){n()},5e3)}},_observeResize:function(e,t){var n=new ResizeObserver(r(function(e){this._clearTimeout(),this._timerIdForResizeObserverEventDelay=setTimeout(function(){t()},500)},this));n.observe(e),setTimeout(function(){n.disconnect()},1e4)},_clearTimeout:function(){try{clearTimeout(this._timerIdForResizeObserverEventDelay)}catch(e){}}}),w=new(e({$static:{_CONFIG:{}},$constructor:function(){this._sender=new n,this._durationTime=new v,this._contentBody=new y,this._contentBodyMainVideo=new p,this._onUnloadPage=r(this._onUnloadPage,this),this._onTabVisibilityChange=r(this._onTabVisibilityChange,this)},init:function(e){try{this._init(e)}catch(t){}},_init:function(e){var n=f(e.data);n.baseInfo.url=location.href,n.baseInfo.referrer=document.referrer,n.baseInfo.isBackForward=a()?1:0,this._api=e.api,this._baseDataForUnload=n,this._isAlreadySendUnloadLog=!1,t.on(window,"beforeunload",this._onUnloadPage),t.on(window,"pagehide",this._onUnloadPage),t.on(window,"unload",this._onUnloadPage),t.onVisibilityChange(this._onTabVisibilityChange),this._durationTime.init(),e.contentBodyEl&&(this._contentBody.init(e.contentBodyEl),this._contentBodyMainVideo.init(e.contentBodyVideoWrapperSelector,this._contentBody.getLength())),this._sender.send(this._api,function(){var e=f(n);return e.type="load",e}())},unload:function(){if(this._isAlreadySendUnloadLog)return;this._isAlreadySendUnloadLog=!0;var e=this._baseDataForUnload;e.type="unload",e.baseInfo.durationTime=this._durationTime.getDt(),this._contentBody.isActivating()&&(e.extraInfo.contentBody={durationTime:this._contentBodyMainVideo.isMainVideo()?Math.max(this._contentBody.getDurationTime(),this._contentBodyMainVideo.getWatchTimeMs()):this._contentBody.getDurationTime(),readRatio:r(function(){var e=this._contentBody.getReadRate(),t=this._contentBodyMainVideo.getWatchRate();return this._contentBodyMainVideo.isMainVideo()===!1?e:this._contentBodyMainVideo.isTextContainVideoContent()?Math.max(t,e):t},this)(),length:this._contentBody.getLength()},e.extraInfo.contentBody.text={durationTime:this._contentBody.getDurationTime(),readRatio:this._contentBody.getReadRate()},this._contentBodyMainVideo.isMainVideo()&&(e.extraInfo.contentBody.video={watchTime:this._contentBodyMainVideo.getWatchTimeMs(),watchRatio:this._contentBodyMainVideo.getWatchRate()})),this._sender.send(this._api,e)},_onUnloadPage:function(){this.unload()},_onTabVisibilityChange:function(e,t){t.isHidden&&this.unload()}}));window.ma=w,ma.version="1.4.0 (04/08 2021 17:20:29)"})();
